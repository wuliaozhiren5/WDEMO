 
 perl PUClient/script/sort-Xcode-project-file PUClient/PUClient.xcodeproj/project.pbxproj

 打开终端Terminal，输入$ sudo killall -STOP -c usbd 命令回车，即可把进程关闭。插上iPhone，正常连接，问题解决。


##  代码规范
  
  ### 定制目的

  *   规范代码结构，增加代码可读性；
  *   提高可维护性；
  *   促进团队合作；
  *   一定程度上避免bug。

  ### 命名原则

  *   语意清晰

  <colgroup><col><col></colgroup>
  | 

  Code

   | 

  Commentary

   |
  | --- | --- |
  | insertObject:atIndex: | Good. |
  | insert:at: | Not clear; what is being inserted? what does “at” signify? |
  | removeObjectAtIndex: | Good. |
  | removeObject: | Good, because it removes object referred to in argument. |
  | remove: | Not clear; what is being removed? |

  *   Objective-C的方法命名趋向于超长命名，但这会带来良好的代码阅读感受，就像读散文一样，同时还避免了很多不必要的注释。
  *   关于前缀

  1.  需要使用前缀的地方：classes, protocols, functions, constants, and typedef structures, 系统类的catrgory。

  2.  不需要使用前缀的地方： naming methods; methods exist in a name space created by the class that defines them.

  ###### 方法名

  遵循小驼峰命名规则，避免冗余。 使用动词开头表示方法的操作

  ```
  - (void)invokeWithTarget:(id)target;
  - (void)selectTabViewItem:(NSTabViewItem *)tabViewItem;

  ```

  在每个参数前面加入修饰词，如

  ```
  //good
  - (void)sendAction:(SEL)aSelector toObject:(id)anObject forAllCells:(BOOL)flag;

  //bad
  - (void)sendAction:(SEL)aSelector :(id)anObject :(BOOL)flag;

  ```

  参数前面紧挨着修饰词，如

  ```
  //good
  - (id)viewWithTag:(NSInteger)aTag;

  //bad 
  - (id)taggedView:(int)aTag;

  ```

  ```
  - (BOOL)tableView:(UITableView *)tableView shouldSelectRowAtIndexPath:(NSIndexPath *)indexPath;
  - (BOOL)application:(NSApplication *)sender openFile:(NSString *)filename;

  ```

  除非只有一个参数（self）

  ```
  - (BOOL)applicationOpenUntitledFile:(NSApplication *)sender;

  ```

  也有一些例外，如传递一个通知，或者仅需要delegate做一些与调用者无关的处理

  ```
  - (void)windowDidChangeScreen:(NSNotification *)notification;

  ```

  使用“did”，“will”等描述来通知delegate事件发生的时机

  ```
  - (void)browserDidScroll:(NSBrowser *)sender;

  ```

  用should来询问delegate是否需要执行某些操作

  ```
  - (BOOL)windowShouldClose:(id)sender;

  ```

  ###### 属性与变量名

  属性名遵循小驼峰命名规则，尽量完整解释属性的意义，如：

  ```
  @property (nonatomic, strong) NSMutableArray<NSString*> *suitTabDataArray;
  @property (nonatomic, copy) NSString *title;

  ```

  BOOL的属性的形容词，getter省略了is，可以指定getter来提高代码可读性，如：

  ```
  @property (nonatomic, getter=isEditable) BOOL editable;

  ```

  除非必须，不需要手动@synthesize属性。

  在访问setter/getter的时候，尽量使用 点符号语法。而不是显示的调用setter/getter。而方法调用的时候则不应该使用 点符号语法。

  ```
  //good
  view.backgroundColor = [UIColor orangeColor];  
  [UIApplication sharedApplication].delegate = self; 

  //bad
  [view setBackgroundColor:[UIColor orangeColor]];  
  [UIApplication.sharedApplication setDelegate:self];

  ```

  局部变量命名应该尽量描述清楚该变量的意义：

  ```
  //good
  int numErrors;
  int numCompletedConnections;
  tickets = [[NSMutableArray alloc] init];
  userInfo = [someObject object];
  port = [network port];

  //bad
  int w;
  int nerr;
  int nCompConns;
  tix = [[NSMutableArray alloc] init];
  obj = [someObject object];
  p = [network port];

  ```

  ###### 资源文件名

  资源文件名用小写字母并用 _ 分割，如:

  `[impress_loading@2x.png](mailto:impress_loading@2x.png)`

  `[video_play@2x.png](mailto:video_play@2x.png)`

  png素材都要在`Images.xcassets`中管理。

  ### 代码组织结构

  使用 `#pragma mark -`来分割组织 常用的mark：

  ```
  #pragma mark - UITableViewDelegate
  #pragma mark - Life cycle
  #pragma mark - Over ride
  #pragma mark - target actions

  ```

  ### 代码习惯

  *   如无必要，避免在init与dealloc中访问self：

  ```
  - (instancetype)init {
    self = [super init];
    if (self) {
      _bar = [[NSMutableString alloc] init];  // good
    }
    return self;
  }

  - (void)dealloc {
     _tableView.delegate = nil;
  }

  ```

  而不是

  ```
  - (instancetype)init {
    self = [super init];
    if (self) {
      self.bar = [NSMutableString string];  // avoid
    }
    return self;
  }

  - (void)dealloc {
    self.tableView.delegate = nil;  // avoid
  }

  ```

  *   每个类单独成文件，尽量不要在一个文件中实现多个类。

  *   多用语法糖，如：

  ```
  NSArray *theStuff = @[
      @"Got some long string objects in here.",
      [AndSomeModelObjects too],
      @"Moar strings."
  ];

  NSDictionary *keyedStuff = @{
      @"this.key": @"corresponds to this value",
      @"otherKey": @"remoteData.payload",
      @"some": @"more",
      @"JSON": @"keys",
      @"and": @"stuff",
  };

  dataList[0];
  dataDict[@"key"];

  ```

  *   Category扩展覆盖方法需要加上特定的前缀，防止与其它的category的方法因重名被覆盖。

  ```
  @interface NSString(RRTVSize)

  - (CGSize)RRTVSizeWithFont:(UIFont *)font;

  @end

  ```

  *   函数换行与对齐

  多参数函数可以通过换行，并按照 : 对齐的方法提高阅读性，如

  ```
  //Animate Timer 
  timer = [NSTimer scheduledTimerWithTimeInterval:ANIMATION_DELAY
                                           target:self
                                         selector:@selector(animateIcon:)
                                         userInfo:nil
                                          repeats:YES];

  ```

  但是大量使用block的地方可以不换行，防止代码可读性更差，如

  ```
  [UIView animateWithDuration:1.0 animations:^{
      // something
  } completion:^(BOOL finished) {
      // something
  }];

  ```

  *   黄金路径

  ```
  //good
  - (void)someMethod {
    if (![someOther boolValue]) {
      return;
    }

    //Do something important
  }

  //bad
  - (void)someMethod {
    if ([someOther boolValue]) {
      //Do something important
    }
  }

  ```

  ### 代码注释

  *   逻辑分支注释紧跟着逻辑分支入口的括号下面一行 通过行注释来写：

  ```
  switch (response.errCode) {
      case WXSuccess: {
      //微信支付成功
          [CommonUtils popTipWithMessage:@"支付成功"];
          [CommonUtils postNotifyCenterName:PAYMENT_SUCCESS object:nil];
          break;
      }
      default: {
      //微信支付失败
          [CommonUtils popTipWithMessage:@"支付失败"];
          [CommonUtils postNotifyCenterName:PAYMENT_FAILED object:nil];
          break;
      }
  }

  ```

  *   某一行的注释放在代码上一行紧挨着需要注释的代码，并与上文中间空换行分割

  ```
  CTRunDelegateRef delegate = CTRunDelegateCreate(&callbacks, (__bridge void *)(dict));

  // 使用0xFFFC作为空白的占位符
  unichar objectReplacementChar = 0xFFFC;

  ```

  ### 参考文档

  #### [Google Objective-C Style Guide](https://google.github.io/styleguide/objcguide.xml)

  #### [Coding Guidelines for Cocoa](https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/CodingGuidelines/CodingGuidelines.html)

  #### [Style guide & coding conventions for Objective-C projects](https://github.com/github/objective-c-style-guide)
